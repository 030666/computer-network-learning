#  

计算机网络

##  课程内容总结

1. 计算机网络和互联网
2. 应用层
3. 传输层
4. 网络层：数据平面
5. 网络层：控制平面
6. 数据链路层和局域网
7. 网络安全
8. 无线和移动网络
9. 多媒体网络
10. 网络管理

# 第一章、计算机网络和互联网

##  1、什么是Internet?

**1.1 从具体构成角度 **

​	**零件的角度**

  + 节点
     + 主机及其上运行的应用程序
     + 路由器、交换机等网络交换设备
  + 边：通信链路
    + 接入网链路：主机连接到互联网的链路
    + 主干链路：路由器间的链路
  + 协议

**1.2 从网络互联设备的角度**

 * 协议控制发送  、接收消息
   * 如TCP、IP、HTTP、FTP、PPP
 * Internet:"网络的网络“
   * 松散的层次结构，互联的ISP
   * 公共的Internet VS 专用的intranet
 * Internet 标准
   * RFC: Request for comments
   * IETF: Internet Engineering Task Force

 **1.3 协议**

> 定义了在两个或多个通信实体（对等层的实体）之间交换的报文格式和次序，以及在报文传输和/或接受或其他事件方面所采取的动作；

**1.4 从服务的角度**

 * 使用通信设施进行通信的分布式应用
   * Web、VoIP、email、分布式游戏、电子商务、社交平台……
 * 通信基础设施为apps提供编程接口（通信服务）
   * 将发送和接收数据的apps与互联网连接起来
   * 为app应用提供服务类型、类似于邮政服务
     * 无连接不可靠服务
     * 面向连接的可靠服务

##  2、网络边缘

**2.1 补充**

 * 网络结构
   * 主机
   * 应用程序
 * 网络核心
   * 互连着的路由器
   * 网络的网络
 * 接入网、物理媒体
   * 有线或者无线通信链路

**2.2 网络边缘**

 * 端系统(主机)
   * 运行应用程序
   * 如Web、email
   * 在“网络的边缘”
 * 客户/服务器模式
   * 客户端向服务器请求、接受服务
   * 如Web浏览器 / 服务器：email客户端 / 服务器
 * 对等(peer-peer) 模式
   * 很少（甚至没有）专门的服务器
   * 如 Gnutella、KaZaA,Emule
   * 每个节点既是服务器也是客户端，互相请求、分布式系统，无客户 / 服务器模式的缺陷如迅雷等。

**2.3 网络边缘：采用网络设施的面向连接服务**

1. 目标：在端系统之间传输数据
2. 握手：在数据传输之前做好准备
   +  人类协议中：你好、你好
   +  两个通信主机为连接建立状态
3. TCP-传输控制协议（Transmission Control Protocol）
   	+ Internet上面面向连接的服务

> TCP服务
>
> * 可靠的、按顺序地传送数据
>   * 确认和重传
> * 流量控制
>   * 发送方不会淹没接收方
> * 拥塞控制
>   * 当网络拥塞时，发送方降低发送速率

**2.4 网络边缘：采用基础设施地无连接服务**

 1. 目标：在端系统之间传输数据

    	1. 无连接服务

 2. UDP-用户数据报协议（User Datagram Protocol)

    + 无连接

    - 不可靠数据传输

    + 无流量控制

    + 无拥塞控制

 3. 使用TCP的应用

    * HTTP(Web)，FTP(文件传送)，Telnet(远程登陆)，SMTP(email)

 4. 使用UDP的应用

    * 流媒体、远程会议、DNS、Internet电话

## 3、网络核心

**3.1 网络核心**

1. 网络核心
2. 基本问题：数据怎样通过网络进行传输
   1. 电路交换
   2. 分组交换
      * 将要传送的数据分成一个个单位：分组（pocket)
      * 将分组从一个路由器传到相邻路由器（hop），一段段最终从源端传送到目标端
      *  每段：采用链路的最大传输能力（带宽）

**3.2 网络核心：电路交换**

> 端到端的资源被分配给从源端到目标端的呼叫叫"call"

1. 独享资源：不同享
    * 每个呼叫一旦建立起来就能够保证性能
2. 如果呼叫没有数据发送，被分配的资源就会被浪费
3. 通常被传统电话网络采用

**3.3 网络核心：电路交换**

> 为呼叫预留端-端资源

1. 链路带宽、交换能力
2. 专用资源：不共享
3. 保证性能
4. 要求建立呼叫连接
5. 网络资源（如带宽）被分成片
    * 为呼叫分配片
    * 如果某个呼叫没有数据，则其资源片处于空闲状态（不共享)
    * 将带宽分成片
      	* 频分
      	* 时分
      	* 波分

**3.4 电路交换不适合计算机之间的通信**

1. 连接建立时间长
2. 计算机之间的通信有突发性，如果使用线路交换，则浪费的片较多
   * 即使这个呼叫没有数据传输，其所占据的片也不能被别的呼叫使用

3. 可靠性不高？

**3.5 网络核心：分组交换**

1. 以分组为单位存储-转发方式
            + 网络带宽资源不再分为一个个片，传输时使用全部带宽
            + 主机之间传输的数据被分成一个个分组
2. 资源共享、按需使用
      * 存储-转发：分组每次移动一跳（hop)
         * 在转发之前，节点必须收到整个分组
         * 延迟比线路交换要大
         * 排队时间

**3.6 分组交换：存储-转发**

1. 被传输到下一个链路之前，整个分组必须到达路由器：存储-转发
2. 在一个速率为R bps的链路，一个长度为L bits的分组的存储延时：L/R s


**3.7 分组交换：排队延迟和丢失**
 *  如果到达速率>链路的输出速率
   * 分组将会排队，等待传输
   * 如果路由器的缓存用完了，分组将会被抛弃

**3.7 网络核心的关键功能**

1. 路由：决定分组采用的源到目标的路径	
   + 路由算法

2. 转发：将分组从路由器的输入链路转移到输出链路

**3.8 分组交换 VS 电路交换**

> 同样的网络资源，分组交换允许更多用户使用网络！
> 

分组交换是“突发数据的胜利者？”

1. 适合于对突发式数据传输
   + 资源共享
   +  简单，不比建立呼叫
2. 过度使用会造成网络拥塞：分组延时和丢失
   + 对可靠的数据传输需要协议来约束：拥塞控制

**3.9 分组交换网络：存储-转发**

1. 分组交换：分组的存储转发一段一段从源端传到目标端，按照有无网络层的连接，分为：
   1. 数据报网络：
         * 分组的目标地址决定下一跳
         * 在不同的阶段，路由可以改变
         * 类似：问路
         * Internet
   2. 虚电路网络
        * 每个分组都带标签（虚电路标识VCID），标签决定下一跳
        * 在呼叫建立时决定路径，在整个呼叫中路径保持不变
        * 路由器维持每个呼叫的状态信息
        * X.25和ATM


**3.10 数据报（datagram）的工作原理**

 * 在通信之前，无需建立起一个连接，有数据就传输
 * 每一个分组都独立路由（路径不一样，可能会失序）
 * 路由器根据分组的目标地址进行路由

**3.11 总结**

![总结](https://gitee.com/xatu-han-chen/computer-network-learning/raw/672b581f283fedc731e1b9f8295e3d0a3215d150/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.3.png)

> 数据报是按地址找人，不事先确定路好不好走；
>
> 虚电路是先去一次，熟悉一下路线，再进行发送



## 4、接入网和物理媒体

**4.1 Q:怎样将端系统和边缘路由器连接？**

1. 住宅接入网络
2. 单位接入网络（学校、公司）
3. 无线接入网络
4. 注意：
   + 接入网络的带宽（bits per second）
   + 共享/专用

**4.2 住宅接入：modern**

1. 将上网数据==调制==加载音频信号上，在电话线上传输，在局端将其中的数据==解调==出来；反之亦然
   + 调频
   + 调幅
   + 调相位
   + 综合调制
2. ==拨号调制解调器==
   + 56Kbps的速率直接接入路由器（通常更低）
   + 不能同时上网和打电话；不能总是在线



**4.3 接入网：digital subscriber line(DSL)**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/ceda966329fe0ef748714c8ffef6d84776283e72/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.png)



          1. 采用==现存的==到交换局DSLAM的电话线
             + DSL线路上的数据被传到互联网
             + DSL线路上的语音被传到电话网
          2. <2.5 Mbps上行传输速率（typically<1 Mbps）
          3. <24 Mbps下行传输速率（typically<10 Mbps）

**4.4 接入网:线缆网络**



![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/58e5fd6577d46442714cdf205045ad2e25c62ca3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.2.png)



有线电视信号线缆双向改造

> FDM:在不同频段传输不同信道的数据，数字电视和上网数据（上下行）

1. HFC:hybird fiber coax
   + 非对称：最高30Mbps的下行传输速率，2 Mbps上行传输速率
2. ==线缆和光纤网络==将每个家庭用户接入到 ISP 路由器
3. 各用户==共享==到线缆头端的接入网络
   + 与DSL不同，DSL每个用户一个专用线路到CO（central office)

**4.5 住宅接入：电缆模式**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/3291a9daead09c3cd0a446a75018b81abbb574d1/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.3.png)



**4.6 接入网：家庭网络**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/3291a9daead09c3cd0a446a75018b81abbb574d1/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.4.png)

**4.7 企业接入网路**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/921b0005314c1e2da3b4367a46b976e8a862170c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.5.png)



1. 经常被企业或者大学等机构采用
   + 10 Mbps,100 Mbps,1Gbps,10Gbps传输率
   + 现在，端系统经常直接接到以太网交换机上

**4.8 无线接入网络**

1. 各无线端系统共享无线接入网络（端系统到无线路由器）
   + 通过基站或者接入点

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/921b0005314c1e2da3b4367a46b976e8a862170c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.4.6.png)

**4.9 物理媒体**

1. Bit:在发送-接收时间传播
2. 物理链路：连接每个发送-接收对之间的物理媒体
3. 导引型媒体：
   + 信号沿着固体媒介被导引：同轴电缆、光纤、双绞线
4. 非导引型媒体
   + 开放的空间传输电磁波或者光信号，在电磁或者光信号中承载数字数据
5. 双绞线（TP）
   + 两根绝缘铜导线拧合

**4.10 物理媒体：同轴电缆、光纤**

1. 同轴电缆：
   + 两根同轴的铜导线
   + 双向
   + 基带电缆
   + 宽带电缆
2. 光纤和光缆
   + 光脉冲，每个脉冲表示一个bit，在玻璃纤维中传输
   + 高速：点到点的高速传输（如10Gbps-100Gbps传输速率）
   + 低误码率：在两个中继器之间可以有很长的距离，不受电磁噪声的干扰
   + 安全

**4.11 物理媒介：无线链路**

1. 开放空间传输电磁波，携带要传输的数据
2. 无需物理：”线缆“
3. 双向
4. 传播环境效应’
   + 反射
   + 吸收
   + 干扰
5. 无线链路类型‘
   + 地面微波
   + LAN
   + wide-area
   + 卫星

## 5、Internet结构和ISP



**5.1 互联网络结构：网络的网络**

1. 端系统通过==接入ISPs==(Internet Service Providers)连接到互联网
   + 住宅，公司和大学的ISPs
2. 接入ISPs相应的必须是互联的
   + 因此任何2个端系统可互相发送分组到对方
3. 导致的“网络的网路”非常复杂
   + 发展和演化是通过==经济的==和==国家的==政策来驱动

4. 竞争：如果全局ISP是有利可为的业务，那会有竞争者

5. 合作：通过ISP之间的合作可以完成业务的扩展，肯定会有互联，对等互联的结算关系

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/855b55d8d9a0752771cec12cca9ce423df5818ba/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.1.png)



6. 然后业务会细分（全球接入和区域接入），区域网络将出现，用于将接入ISPs连接到全局ISPs

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/5ceccb9bb2f3e2e778f6f4bbb33f12b22053775a/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.2.png)

7. 然后==内容提供商网络（Internet Content Providers==,e.g.,Google,Microsoft,Akamai)可能会构建它们自己的网络，将它们的服务、内容更加靠近端用户，向用户提供更好的服务，减少自己的运营支出。

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/5ceccb9bb2f3e2e778f6f4bbb33f12b22053775a/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.3.png)

8. 在网络的最中心，一些为数不多的充分连接的大范围网络（分布广、节点有限、但是之间有着多重连接）

   + “tier-1" commercial ISPs,国家或者国际范围的覆盖

   + ==content provider network==:将它们的数据中心接入ISP，方便周边用户的访问；通常私有网络之间用专网绕过第一层ISP和区域

     ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/5ceccb9bb2f3e2e778f6f4bbb33f12b22053775a/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.4.png)

**5.2 Internet结构：network of networks**

1. 松散的层次模型
2. ==中心：第一层ISP==（如UUNet,BBN/Genuity,Sprint,AT&T)国家/国际覆盖，速率极高
   + 直接与其他第一层ISP相连
   + 与大量的第二层ISP和其他客户网络相连

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/12434a7f5b087f3c71dee8a0f05716c53190689c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.5.png)

3. 第二层ISP:更小些的（通常是区域性的）ISP

   + 与一个或多个第一层ISPs，也可能与其他第二层ISP

     ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/12434a7f5b087f3c71dee8a0f05716c53190689c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.6.png)

4. 第三层ISP与其他本地ISP

   + 接入网（与端系统最近）

     ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/12434a7f5b087f3c71dee8a0f05716c53190689c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.7.png)

**5.3 互联网结构：网络的网络**

1. 很多内容提供商（如：Google）可能会部署自己的网络，连接自己的在各地的DC(数据中心)，走自己的数据
2. 连接若干local ISP和各级（包括一层）ISP，更加靠近用户

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/12434a7f5b087f3c71dee8a0f05716c53190689c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.5.8.png)



**5.4 ISP之间的连接**

1. POP：高层ISP面向客户网络的接入点，涉及费用结算
   + 如一个低层ISP接入多个高层ISP，多宿（multi home)
2. 对等接入：2个ISP对等互联，不涉及费用结算
3. IXP;多个对等ISP互联互通之处，通常不涉及费用结算
   + 对等接入
4. ICP自己部署专用网络，同时和各级ISP连接



## 6、分组延时、丢失和吞吐量



**6.1 分组丢失和延时是怎样发生的？**

1. 在路由器缓冲区的分组队列
   + ==分组到达链路的速率超过了链路输出的能力==
   + 分组等待排到队头、被传输

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/d548c29d4b984baaeac19b216b310d4d9b9587ce/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.6.1.png)

**6.2 四种分组延时**

1. ==节点处理延时：==

   + 检查bit级差错
   + 检查分组首部和决定将分组导向何处

2. ==排队延时==

   + 在输出链路上等待传输的时间
   + 依赖于路由器的拥塞程度

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/d548c29d4b984baaeac19b216b310d4d9b9587ce/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.6.2.png)

3. ==传输延时==

   + R=链路带宽（bps)
   + L=分组长度（bits）
   + 将分组发送到链路上的时间=L/R
   + 存储转发延时

4. ==传播延时==

   + d=物理链路的长度

   + s=在媒体上的传播速度

   + 传播延时=d/s

     ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/d548c29d4b984baaeac19b216b310d4d9b9587ce/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.6.3.png)

   5. 节点延时

      **d~nodal~=d~proc~+d~queue~+d~trans~+d~prop~**

      + d~proc~=处理延时
        + 通常是微秒数量级或更少
      + d~queue~=排队延时
        + 取决于拥塞程度
      + d~trans~=传输延时
        + =L/R，对低速率的链路而言很大（如拨号），通常为微秒级到毫秒级
      + d~prop~=传播延时
        + 几微秒到几百毫秒



**6.3 分组丢失**

1. 链路的队列缓冲区容量有限
2. 当分组到达一个满的队列时，该分组将会丢失
3. 丢失的分组可能会被前一个节点或者源端系统重传，或者根本不重传

**6.4 吞吐量**

1. 吞吐量：在源端和目标端之间传输的速率（数据量/单位时间）
   + ==瞬间吞吐量==：在一个时间点的速率
   + ==平均吞吐量==：在一个长时间内的平均值



## 7、协议层次及服务模型
**7.1 协议层次**
==网络是一个复杂的系统！==
1. 网络功能繁杂：数字信号的物理信号承载、点到点、路由、rdt、进程区分、应用等
2. 现实来看，网络的许多构成元素和设施：
	+ 主机
	+ 路由器
	+ 各种媒体的链路
	+ 应用
	+ 协议
	+ 硬件、软件

**7.2 例子：两位异地哲学家的交流**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/17a99b49e95f42d7343832213bfd8b2f70c89593/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.7.1.png)

**7.3 航线的功能层次**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/17a99b49e95f42d7343832213bfd8b2f70c89593/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.7.2.png)

1. ==层次化方式实现复杂网络功能==：
	+ 将网络复杂的功能分层功能明确的==层次==，每一层实现了其中一个或一组功能，功能中有其上层可以使用的功能：==服务==
	
	+ 本层协议实体相互交互执行本层的==协议动作==，目的是实现本层功能，通过接口为上层提供更好的服务
	
	+ 在实现本层协议的时候，直接==利用了下层所提供的服务==
	
	+ 本层的服务：借助下层服务实现的本层协议实体之间交互带来的新功能（上层可以利用的）+更下层所提供的服务
	
	  

**7.4 服务和服务站点**
	

1. 服务（Service）：低层实体向上层实体提供它们之间的通信的能力
	+ 通信用户（service user)
	+ 服务提供者（service provider)
	
3. 原语（primitive）：上层使用下层服务的形式，高层使用底层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的--形式

3. 服务访问点SAP（Service Access Point）:上层使用下层提供的服务通过层间的接口---地点；
	+ 例子：邮箱
	+ 地址（address):下层的一个实体支撑着上层的多个实体，SAP有标志不同上层实体的作用
	+ 可以有不同的实现，队列
	+ 例子：传输层的SAP：端口（port)
	
	

**7.5 服务的类型**

1. 面向连接的服务（Connection-oriented Service)
	+ ==连接==：两个通信实体为进行通信而建立的一种结合
	+ 面向连接的服务通信的过程：建立连接，通信，拆除连接
	+ 面向连接的服务的例子：网络层的连接被成为虚电路
	+ 适用范围：对于大的数据块要传输；不适合小的零星报文
	+ 特点：保序
	+ 服务类型：
		+ 可靠的信息流 传送页面（可靠的获得，通过接收方的确认）
		+ 可靠的字节流 远程登陆
		+ 不可靠的连接 数字化的声音
2. 面向无连接的服务（Connectionless Service)
	+ 无连接的服务：两个对等层实体在通信前不需要建立一个连接，不预留资源；不需要通信双方都是活跃；（例：寄信）
	+ 特点：不可靠、可能重复、可能失序
	+ IP分组，数据包
	+ 适用范围：适合传输零星数据
	+ 服务类型：
		+ 不可靠的数据报 电子方式的函件
		+ 有确认的数据报 挂号信
		+ 请求回答 信息查询

**7.6 服务和协议**
1. 服务与协议的区别
	+ 服务：低层实体向上层实体提供它们之间的通信的能力，通过原语来操作的，垂直
	+ 协议：对等层实体之间在相互通信的过程中，需要遵循的规则的集合，水平

2. 服务与协议的联系
	+ 本层==协议的实现==要靠下层提供的服务来实现
	+ 本层实体通过协议为上层==提供更高级的服务==

**7.7 分层处理和实现复杂系统系统的好处？**
==对付复杂的系统==
1. 概念化：结构清晰，便于标示网络组件，以及描述其相互关系
	+ 分层参考模型

2. 结构化：模块化更易于维护和系统升级
	+ 改变某一层的服务的实现不影响系统中的其他层次
		+ 对于其他层次而言是透明的

**7.8 Internet协议栈**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/c1846e43a777cd4b309c24581e83b8e1eeb78dc9/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.7.3.png)

1. ==网络层==：网络应用
   + 为人类用户或者其他应用进程提供网络应用服务
   + FTP、SMAP、HTTP、DNS
2. ==传输层==：主机之间的数据传输
   + 在网络层提供的端到端通信基础上，细分为进程到进程，将不可靠的通信变成可靠的通信
3. ==网络层==：为数据报从源到目的选择路由
   + 主机主机之间的通信，端到端通信，不可靠
   + IP,路由协议
4. ==链路层==：相邻网络节点间的数据传输
   + 2个相邻2点的通信，点到点通信，可靠或不可靠
   + 点对点协议PPP，802.11(wifi)，Ethernet
5. ==物理层==：在线路上传送bit

**7.9 ISO/OSI 参考模型**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/c1846e43a777cd4b309c24581e83b8e1eeb78dc9/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.7.4.png)

1. ==表示层==：允许应用解释传输的数据，例如加密，压缩，机器相关的表示转换
2. ==会话层==：数据交换的同步，检查点，恢复
3. 互联网协议栈没有这两层

**7.10 封装和解封装**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/c1846e43a777cd4b309c24581e83b8e1eeb78dc9/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.7.5.png)

**7.11 各层次的协议数据单元**

1. 应用层：报文（message)
2. 传输层：报文段（segment):TCP段，UDP数据报
3. 网络层：分组packet(如果无连接方式：数据报datagram)
4. 数据链路层：帧（frame)
5. 物理层：位（bit)

## 8、历史

1. 早期（1960以前）计算机网络

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.1.png)

2. 1961-1972:早期的分组交换概念

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.2.png)

3. 1972-1980:专用网络和网络互连

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.3.png)

4. 1980-1990：体系结构变化，网络数量激增，应用丰富

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.4.png)

5. 1990,2000:商业化，Web，新的应用

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.5.png)

6. 2005-现在

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/731c5b9925ff1acefe4b620983a573de06f531a3/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/1.8.6.png)

## 9、小结

**小结**

1. Internet
2. 什么是协议
3. 网络边缘，核心，接入网络
   + 分组交换 VS 电路交换
4. Internet / ISP 结构
5. 性能：丢失，延时，吞吐量
6. 层次模型和服务模型
7. 历史

**小结1**

1. 组成角度看什么是互联网
   + 边缘：端系统（包括应用）+接入网
   + 核心：网络交换设备+通信链路
   + 协议：对等层实体通信过程中遵守的规则的集合
     * 语法、语义、时序
2. 为了实现复杂的网络功能，采用分层方式设计、实现的调试
   + 应用层、传输层、网络层、数据链路层、物理层
   + 协议数据单位
     + 报文、报文段、分组、帧、位
3. 从服务角度看互联网
   + 通信服务基础设施
     + 提供的通信服务：面向连接、无连接
   + 应用
4. 应用之间的交互
   + C / S模式
   + P2P模式



**小结2**

1. 数据交换

   + 分组数据交换
   + 线路交换

2. 比较线路交换和分组交换

3. 分组交换的2种方式

   + 虚电路
   + 数据报

4. 接入网和物理媒介

   + 接入网技术：
     + 住宅：ADSL，拨号
     + 单位：以太网
     + 无线接入方式
   + 物理媒介
     + 光纤，同轴电缆，以太网，双绞线

5. ISP层次结构

**小结3**

1. 分组交换网络中延迟和丢失是如何发生的
   + 延迟的组成：处理、传输、传播、排队
2. 网络的分层体系结构
   + 分层体系结构
   + 服务
   + 协议数据单元
   + 封装与解封装
3. 历史

# 第二章 应用层

## 0、总结

**提纲**

1. 2.1 应用层协议原理
2. 2.2 Web and HTTP
3. 2.3 FTP*
4. 2.4 Email
   + SMTP
   + POP3
   + IMAP
5. 2.5 DNS
6. 2.6 P2P应用
7. 2.7 CDN
8. 2.8 TCP套接字（Socket）编程
9. 2.9 UDP套接字编程

**目标**

1. 网络应用的原理：网络应用协议的概念和实现方面
   + 传输层的服务模型
   + 客户-服务器模式
   + 对等模式（peer-to-peer）
   + 内容分发网络
2. 网络应用的实例：互联网流行的应用层协议
   + HTTP
   + FTP
   + SMTP / POP3 / IMAP
   + DNS
3. 编程：网络应用程序
   + Socket API

## 1、应用层协议原理

**1.0 创建一个新的网络应用**

1. 编程
   + 在不同的端系统上运行
   + 通过网络基础设施提供的服务，应用进程彼此通信
   + 如Web:
     + Web服务器软件与浏览器软件通信
2. 网络核心中没有应用层软件
   + 网络核心没有应用层功能
   + 网络应用只在端系统上存在，快速网络应用开发和部署

**1.1 网络应用的体系结构**

可能的应用架构：

1. 客户-服务器模式（C/S模式）
2. 对等模式（P2P模式）
3. 混合体：客户-服务器和对等体系结构

**1.2 客户-服务器（C/S）体系结构**

1. ==服务器：==
   + 一直运行
   + 固定的IP地址和周知的端口号（约定）
   + 扩展性：服务器场
     + 数据中心进行扩展
     + 扩展性差
2. ==客户端：==
   + 主动与服务器通信
   + 与互联网有间歇性的连接
   + 可能是动态IP地址
   + 不直接与其他客户端通信

**1.3 对等体（P2P）体系结构**

1. （几乎）没有一直运行的服务器
2. 任意端系统之间可以进行通信
3. 每一个节点既是客户端又是服务器
   + 自扩展性-新peer节点带来新的服务能力，当然也带来新的服务请求
4. 参与的主机间歇性连接且可以改变IP地址
   + 难以管理
5. 例子：迅雷

**1.4 C / S 和P2P体系结构的混合体**

==Napster==

1. 文件搜索：集中

   + 主机在中心服务器上注册其资源
   + 主机向中心服务器查询资源位置

2. 文件传输：P2P

==即时通信==

1. 在线检测：集中
   + 当用户上线时，向中心服务器注册其IP地址
   + 用户与中心服务器联系，以找到其在线好友的位置
   + 两个用户之间聊天：P2P


**1.5 进程通信**

> 客户端进程：发起通信的进程
>
> 服务器进程：等待连接的进程

1. ==进程：==在主机上运行的应用程序
2. 在同一个主机内，使用==进程间通信机制==通信（操作系统定义）
3. 不同主机，通过交换==报文（Message)==来通信
   + 使用OS提供的通信服务
   + 按照应用协议交换报文
     + 借助传输层提供的服务

> 注意：P2P架构的应用也有客户端进程和服务器进程之分

**1.6 分布式进程通信需要解决的问题**

1. 问题1：进程标示和寻址问题（==服务用户==）
2. 问题2：传输层-应用层提供服务是如何（==服务==）
   + 位置：层间界面的SAP（TCP/IP:socket）
   + 形式：应用程序接口API(TCP/IP：socket API)
3. 问题3：如何使用传输层提供的服务，实现应用程序之间的报文交换，实现应用（==用户使用服务==）
   + 定义应用层协议：报文格式，解释，时序等
   + 编制程序，使用OS提供的API，调用网络基础设施提供通信服务传报文，实现应用时序等；

**1.7 问题1：==对地址进行编址==**

1. 进程为了接收报文，必须有一个标示，即:SAP（发送也需要标示）
   + 主机：唯一的32位IP地址
     + 仅仅有IP地址不能够唯一标识一个进程；在一台端系统上有很多应用进程在运行
   + 所采用的传输层协议：TCP or UDP
   + ==端口号（Port Numbers)==
2. 一些知名端口号的例子：
   + HTTP:TCP 80
   + Mail:TCP 25
   + ftp:TCP 2
3. 一个进程，用IP+port标示端节点
4. 本质上，一对主机进程之间的通信由2个端节点构成

**1.8 问题2：**

**1.8.1 问题2：传输层提供的服务-需要穿过层间的信息**

1. 层间接口必须要携带的信息
   + 要传输的报文（对于本层来说：SDU）
   + 谁传的：己方的应用进程的标示：IP+TCP(UDP)端口
   + 传给谁：对方的应用进程的标示：对方的IP+TCP(UDP)端口
2. 传输层实体（tcp或者udp实体）根据这些信息进行TCP报文段（UDP数据报）的封装
   + 源端口号，目标端口号，数据等
   + 将IP地址往下交IP实体，用于封装IP数据报：源IP，目标IP

**1.8.2 问题2：传输层提供的服务-层间信息的代表**

1. 如果Socket API每次传输报文，都携带如此多的信息，太繁琐易错，不便于管理
2. 用个代号标示通信的双方或者单方：socket
3. 就像OS打开文件返回的句柄一样
   + 对句柄的操作，就是对文件的操作
4. TCP socket:
   + TCP服务，两个进程之间的通信需要之前要建立连接
     + 两个进程通信会持续一段时间，通信关系稳定
   + 可以用一个整数表示两个应用实体之间的通信关系，==本地==标示
   + 穿过层间接口的信息量==最小==
   + TCP socket:源IP，源端口，目标IP，目标端口

**1.8.3 TCP之上的套接字（socket)**

1. 对于使用面向连接服务（TCP)的应用而言，套接字是4元组的一个具有==本地意义的标示==

   + 4元组：==（源IP，源port，目标IP，目标port)==
   + 唯一的指定了一个会话（2个进程之间的会话关系）
   + 应用使用的这个标示，与远程的应用进程通信
   + 不必在每一个报文的发送都要指定这4元组
   + 就像使用操作系统打开一个文件，OS返回一个文件句柄一样，以后使用这个文件句柄，而不是使用这个文件的目录名、文件名
   + 简单，便于管理

2. TCP socket

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/48f9dc03cfab25e5619e3d640233d894089efec8/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.1.png)

3. TCP socket

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/48f9dc03cfab25e5619e3d640233d894089efec8/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.2.png)

**1.8.4 问题2：传输层提供的服务-层间信息代码**

1. UDP socket:
   + UDP服务，两个进程之间的通信需要之前无需建立连接
     + 每个报文都是独立传输的
     + 前后报文可能给不同的分布式进程
   + 因此，只能用一个整数表示本应用实体的标示
     + 因为这个报文可能传给另外一个分布式进程
   + 穿过层间接口的信息大小最小
   + UDP socket:本IP,本端口
   + 但是传输报文时：必须要提供对方的IP，port
     + 接收报文时：传输层需要上传对方的IP，port



**1.8.5 UDP之上的套接字（socket)**

1. 对于使用无连接服务（UDP）的应用而言，套接字是2元组的一个具有==本地意义的标示==
   + 2元组：IP，port(源端指定)
   + UDP套接字指定了应用所在的一个==端节点（end point)==
   + 在发送数据报时，采用创建好的本地套接字（标示ID），就不必在发送每个报文中指明自己所采用的ip和port
   + 但是在发送报文时，必须要指定对方的ip和udp port

**1.8.6 UDP socket**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/48f9dc03cfab25e5619e3d640233d894089efec8/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.3.png)

**1.8.7 套接字（Socket)**

1. 进程向==套接字==发送报文或从套接字接收报文
2. 套接字<->门户
   + 发送进程将报文退出门户，发送进程依赖于传输层设施在另外一侧的门将报文交付给接收进程
   + 接收进程从另外一端的门户收到报文（依赖于传输层设施）

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/37e81adbeedbf53c685aa061fc58426d32f8cace/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.4.png)**1.9 问题3：如何使用传输层提供的服务实现应用**

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/37e81adbeedbf53c685aa061fc58426d32f8cace/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.5.png)

1. 定义应用层协议：报文格式，解释，时序等
2. 编制程序，通过API调用网络基础设施提供通信服务传报文，解析报文，实现应用时序等

**1.10 应用层协议**

1. 定义了：运行在不同端系统上的应用进程如何相互交换报文
   + 交换的==报文类型==：请求和应答报文
   + 各种报文类型的==语法==：报文中的各个字段及其描述
   + 字段的==语义==：即字段取值的含义
   + 进程何时、如何发送报文及对报文进行响应的==规则==
2. 应用协议仅仅是应用的一个组成部分
   + Web应用：HTTP协议，web客户端，web服务器，HTML
3. ==公开协议：==
   + 由RFC文档定义
   + 允许互操作
   + 如HTTP,SMTP
4. ==专用（私有）协议：==
   + 协议不公开
   + 如：skype

**1.11 应用层需要传输层提供什么样的服务？如何描述传输层的服务？**

1. ==数据丢失率==

   + 有些应用则要求100%的可靠数据传输（如文件）
   + 有些应用（如音频）能容忍一定比例以下的数据丢失

2. ==延迟==

   + 一些应用出于有效性考虑，对数据传输有严格的时间限制
     + Internet电话，交互式游戏
     + 延迟、延迟差

3. ==吞吐==

   + 一些应用（如多媒体）必须需要最小限度的吞吐，从而使得应用能够有效运转
   + 一些应用能充分利用可供使用的吞吐（弹性应用）

4. ==安全性==

   + 机密性
   + 完整性
   + 可认证性（鉴别）

5. 常见应用对传输服务的要求

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/37e81adbeedbf53c685aa061fc58426d32f8cace/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.1.6.png)

   **1.12 Internet 传输层提供的服务**

   1. ==TCP服务：==
      + 可靠的传输服务
      + 流量控制：发送方不会淹没接收方
      + 拥塞控制：当网络出现拥塞时，能抑制发送方
      + 不能提供的服务：时间保证、最小吞吐保证和安全
      + 面向连接：要求在客户端进程和服务器进程之间建立连接
   2. ==UDP服务：==
      + 不可靠数据传输
      + 不提供的服务：可靠，流量控制、拥塞控制、时间、带宽保证、建立连接
   3. ==UDP存在的必要性
      + 能够==区分不同的进程==，而IP服务不能
        + 在IP提供的主机到主机端到端功能的基础上，区分了主机的应用进程
      + ==无需建立连接==，省去了建立连接时间，适合事务性的应用
      + ==不做可靠性的工作==，例如检错重发，适合那些对实时 性要求比较高而对正确性要求不高的应用
        + 因为为了实现可靠性（准确性、保序等），必须付出时间代 价（检错重发）
      + 没有拥塞控制和流量控制，==应用能够按照设定的速度发送数据==
        + 而在TCP上面的应用，应用发送数据的速度和主机向网络发送 的实际速度是不一致的，因为有流量控制和拥塞控制
   4. 安全TCP
      + TCP & UDP
        + 都没有加密
        + 明文通过互联网传输，甚至密码
      + SSL
        + 在TCP上面实现，提供加密的TCP连接
        + 私密性
        + 数据完整性
        + 端到端的鉴别
      + SSL在应用层
        + 应用采用SSL库，SSL库使用TCP通信
      + SSL socket API
        + 应用通过API将明文交给socket,SSL将其加密在互联网上传输

## 2、Web and HTTP

### 2.1 Web与HTTP的一些术语

1. ==Web页==：由一些==对象==组成
2. 对象可以是HTML文件，JPEG图像，Java小程序，声音剪辑文件等
3. Web页含有一个==基本的HTML文件==，该基本HTML文件又包含若干对象的引用（链接）
4. 通过==URL（统一资源定位符）==对每个对象进行引用
	+ 访问协议，用户名，口令字，端口等
5. URL格式：[带方括号的为可选项]
       protocol :// hostname[:port] / path / \[;parameters]\[?query]#fragment
>protocol：协议
>
>>file 资源是本地计算机上的文件。格式file:///，注意后边应是三个斜杠。
>>ftp 通过 FTP访问资源。格式 FTP://
>>gopher 通过 Gopher 协议访问该资源。
>>http 通过 HTTP 访问该资源。 格式 HTTP://
>>https 通过安全的 HTTPS 访问该资源。 格式 HTTPS://
>>mailto 资源为电子邮件地址，通过 SMTP 访问。 格式 mailto:
>
>hostname：主机名
>>是指存放资源的服务器的域名系统(DNS) 主机名或 IP 地址。有时，在主机名前也可以包含连接到服务器所需的用户名和密码（格式：username:password@hostname）
>
>port:端口号
>>整数，可选，省略时使用方案的默认端口，各种传输协议都有默认的端口号，如http的默认端口为80。如果输入时省略，则使用默认端口号。有时候出于安全或其他考虑，可以在服务器上对端口进行重定义，即采用非标准端口号，此时，URL中就不能省略端口号这一项。
>
>path:路径
>>由零或多个“/”符号隔开的字符串，一般用来表示主机上的一个目录或文件地址。
>
>parameters:参数
>>这是用于指定特殊参数的可选项
>
>query:查询
>
>fragment:信息片段
>
>>字符串，用于指定网络资源中的片段。例如一个网页中有多个名词解释，可使用fragment直接定位到某一名词解释
>>

### 2.2 HTTP概述

1. HTTP：==超文本传输协议==

2. Web的应用层协议

3. 客户/服务器模式;
	+ 客户：请求、接收和显示Web对象的浏览器
	+ 服务器：对请求进行响应，发送对象的Web服务器
	
4. HTTP 1.0:RFC 1945
   HTTP 1.1:RFC 2068
   
5. ==使用TCP==
	5.1 客户发起一个与服务器的TCP连接（建立套接字），端口号为80
	5.2 服务器接收客户的TCP连接
	5.3 在浏览器（HTTP客户端）与Web服务器（HTTP服务器server)交换HTTP报文（应用层协议报文）
	5.4 TCP连接关闭
	
6. ==HTTP是无状态的==
	6.1 服务器并不维护关于客户的任何信息
	
7. 维护状态的协议很复杂！
	+ 必须维护历史信息（状态）
	
	+ 如果服务器/客户端死机，它们的状态信息可能不一致，二者的信息必须是一致
	
	+ 无状态的服务器能够支持更多的客户端
	

### 2.3 HTTP连接

1. ==非持久HTTP：==

   + 最多只有一个对象在TCP连接上发送
   + 下载多个对象需要多个TCP连接
   + HTTP/1.0 使用非持久性连接

2. ==持久HTTP:==

   + 多个对象可以在一个（在客户端和服务器之间的）TCP连接上传输
   + HTTP/1.1 默认使用持久连接

3. 非持久HTTP连接

   假设用户输入了URL:www.someshool.edu/someDept/home.index

   (包含文本和10个JPEG图像的引用)

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/2194c7568bb24f4fbd1f21132c692a89b4e3993c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.1.png)

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/2194c7568bb24f4fbd1f21132c692a89b4e3993c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.2.png)

   4. 响应时间模型

      + ==往返时间RTT(round-trip-time)==:一个小的分组从客户端到服务器，再回到客户端的时间（传输时间忽略）
      + ==响应时间==：
        + 一个RTT用来发起TCP连接
        + 一个RTT用来发送HTTP请求并等待HTTP响应
        + 文件传输时间
        + ==共2RTT+传输时间

      ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/2194c7568bb24f4fbd1f21132c692a89b4e3993c/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.3.png)

      5. 持久HTTP

         ==5.1 非持久HTTP的缺点：==

         + 每个对象要2个RTT
         + 操作系统必须为每个TCP连接分配资源
         + 但浏览器通常打开并行TCP连接，以获取引用对象

         ==5.2 持久HTTP==

         + 服务器在发送响应后，仍保持TCP连接
         + 在相同客户端和服务器之间的后续请求和响应报文通过相同的连接进行传送
         + 客户端在遇到一个引用对象的时候，就可以尽快发送该对象的请求

         ==5.3 非流水方式的持久HTTP:==

         + 客户端只能在收到前一个响应后才能发出新的请求
         + 每个引用对象花费一个RTT

         ==流水方式的持久HTTP:==

         + HTTP/1.1的默认模式
         + 客户端遇到一个引用对象就立即产生一个请求
         + 所有引用（小）对象只花费一个RTT是可能的

### 2.4 HTTP请求报文

1. 两种类型的HTTP报文：==请求、响应==

2. HTTP请求报文：
   + ASCII(人能阅读)
    ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/77c488b0a093099606089540c61bb99c0ae6c764/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.4.png)
   
3. HTTP请求报文：通用格式

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/77c488b0a093099606089540c61bb99c0ae6c764/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.5.png)

4. 提交表单输入
	4.1 Post方式：
	
	+ 网页通常包括表单输入
	+ 包含在实体主体（entity body)中输入被提交到服务器
	
	4.2 URL方式：
	
	+ 方法：GET
	+ 输入通过请求行的URL字段上载
	
5. 方法类型

  ==HTTP/1.0==

  + GET
  + POST
  + HEAD
    + 要求服务器在响应报文中不包含请求对象->故障跟踪
    + 例如百度，Google搜索引擎用来做检索

  ==HTTP/1.1==

  + GET,POST,HEAD
  + PUT
    + 将实体主体的文件上载到URL字段规定的路径
  + DELETE
    + 删除URL字段规定的文件

### 2.5 响应报文

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/77c488b0a093099606089540c61bb99c0ae6c764/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.6.png)

1. HTTP响应状态码

   位于服务器->客户端的响应报文中的首行

   一些状态码的例子：

   ==200 OK==

   > 请求成功，请求对象包含在响应报文的后续部分

   ==301 Moved Permanently==

   > 请求的对象已经被永久转移了，新的URL在响应报文的Location,首部行中指定
   >
   > 客户端软件自动用新的URL去获取对象

   ==400 Bad Request==

   > 一个通用的差错代码，表示该请求不能被服务器解读

   ==404 Not Found==

   > 请求的文档在该服务上没有找到

   ==505 HTTP Version Not Supported==

### 2.6 用户-服务器状态：cookies

大多数主要的门户网站使用cookies

1. ==四个组成部分：==

   + 在HTTP响应报文中有一个cookies的首部行
   + 在HTTP请求报文含有一个cookies的首部行
   + 在用户端系统中保留有一个cookies文件，由用户的浏览器管理
   + 在Web站点有一个后端数据库

2. 例子：

   + 张三总是用同一个pc使用chrome上网
   + 他第一次访问了一个使用了cookies的电子商务网站
   + 当最初的HTTP请求到达服务器时，该Web站点产生一个唯一的ID，并以此作为索引在它的后端数据库产生一个项

3. Cookies:维护状态

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/77c488b0a093099606089540c61bb99c0ae6c764/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.7.png)

4. Cookies能带来什么：
   + 用户验证
   + 购物车
   + 推荐
   + 用户状态（Web e-mail)
5. 如何维持状态：
   + 协议端节点：在多个事务上，发送端和接收端维持状态
   + cookies:http报文携带状态信息
6. Cookies与隐私
   + Cookies允许站点知道许多关于用户的信息
   + 可能将它知道的东西卖给第三方
   + 使用重定向和cookies的搜索引擎还能知道用户更多的信息
     + 如通过某个用户在大量站点上的行为，了解其个人浏览方式的大致模式
   + 广告公司从站点获得信息

### 2.7 Web缓存（代理服务器）

==目标：==不访问原始服务器，就满足客户的请求

1. 用户设置浏览器：通过缓存访问Web

2. 浏览器将所有的HTTP请求发给缓存

   + 在缓存中的对象：缓存直接返回对象
   + 如对象不在缓存，缓存请求原始服务器，然后再将对象返回给客户端

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/41b664586e6832756ea9b653ee586e69d19e6640/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.8.png)

3. 缓存既是客户端又是服务器

4. 通常缓存是由ISP安装（大学、公司、居民区ISP）

5. ==为什么要使用Web缓存？==
      + 降低客户端的请求响应时间
      + 可以大大减少一个机构内部网络与Internet接入链路上的流量
      + 互联网大量采用了缓存；可以使较弱的ICP也能够有效提供内容
      
6. 条件GET方法
	+ 目标：如果缓存器中的对象拷贝是最新的，就不要发送对象
	+ 缓存器：在HTTP请求中指定缓存拷贝的日期
	     If-modified-since
	     <date>
	+ 服务器：如果缓存拷贝陈旧，则响应报文没包含对象
	     HTTP/1.0 304 Not
	        Modified
	     ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/41b664586e6832756ea9b653ee586e69d19e6640/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.2.9.png)

## 3、FTP*

### 3.1 FTP：文件传输协议

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/eff9d920c6d33a22664079b88a7a5147bb5910f8/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.3.1.png)

1. 向远程主机上传输文件或从远程主机接收文件
2. 客户端/服务器模式
   + 客户端：发起传输的一方
   + 服务器：远程主机
3. ftp RFC 959
4. ftp服务器：端口号为21

### 3.2 FTP:控制连接与数据连接分开

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/eff9d920c6d33a22664079b88a7a5147bb5910f8/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.3.2.png)

1. FTP客户端与FTP服务器通过端口21联系，并使用TCP为传输协议
2. 客户端通过控制连接获得身份确认
3. 客户端通过控制连接发送命令浏览远程记录
4. 收到一个文件传输命令时，服务器打开一个到客户端的数据连接
5. 一个文件传输完成后，服务器关闭连接
6. 服务器打开第二个TCP数据连接用来传输另一个文件
7. 控制连接：==带外（out of band)==传送
8. FTP服务器维护用户的状态信息：当前路径、用户账号与控制连接对应（==有状态==）

### 3.3 FTP命令、响应

1. 命令样例：

   + 在==控制连接==上以ASCII文本方式传送
   + USER username
   + PASS password
   + LIST 请服务器返回远程主机当前目录的文件列表
   + PETR filename 从远程主机的当前目录检索文件（gets)
   + STOR filename 向远程主机的当前目录存放文件（puts)

2. 返回码样例：

   + 状态码和状态信息（同HTTP）

   + 331 Username OK,

       password required

   + 125 data connection 

       already open;

       transfer starting

   + 425 Can' t open data

       connection

   + 452 Error writing

       file

## 4、EMail

### 4.1 电子邮件（email)

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/20cc2f2ea85625157e7c107cfe5e418c2ccbcbda/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.4.1.png)

1. 三个主要组成部分：
   + 用户代理
   + 邮件服务器
   + 简单邮件传输协议：SMTP
   + 用户代理：
     + 又名“邮件阅读器”
     + 撰写、编辑和阅读邮件
     + 如Outlook,Foxmail
     + 输出和输入邮件保存在服务器上

### 4.2 EMail:邮件服务器

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/20cc2f2ea85625157e7c107cfe5e418c2ccbcbda/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.4.2.png)

1. 邮箱中管理和维护发送给用户的邮件
2. 输出报文队列保持待发送邮件报文
3. 邮件服务器之间的SMTP协议：发送email报文
   + 客户：发送方邮件服务器
   + 服务器：接收端邮件服务器

### 4.3 EMail:SMTP[RFC 2821]

1. 使用TCP在客户端和服务器之间传送报文，端口号为25
2. 直接传输：从发送方服务器到接收方服务器
3. 传输的3个阶段 
   + 握手
   + 传输报文
   + 关闭
4. 命令/响应交互
   + 命令：ASCII文本
   + 响应：状态码和状态信息
5. 报文必须 为7位ASCII码

### 4.4 举例：张三给李四发送报文

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/20cc2f2ea85625157e7c107cfe5e418c2ccbcbda/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.4.3.png)

1. 张三使用用户代理撰写邮件并发送给lisi@somechool.edu
2. 张三的用户代理将邮件发送到他的邮件服务器；邮件放在报文队列中
3. SMTP的客户端打开到李四邮件服务器的TCP连接
4. SMTP客户端通过TCP连接发送张三的邮件
5. 李四的邮件服务器将邮件放到李四的邮箱
6. 李四调用他的用户代理阅读邮件

### 4.5 SMTP:总结

1. SMTP使用持久连接
2. SMTP要求报文（首部和主体）为7位ASCII编码
3. SMTP服务器使用CRLF.CRLF决定报文的尾部
4. ==HTTP比较：==
   + HTTP：拉（pull)
   + SMTP:推（push)
   + 二者都是ASCII形式的命令/响应交互、状态码
   + HTTP:每个对象封装在各自的响应报文中
   + SMTP：多个对象包含在一个报文中

### 4.6 邮件报文格式

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/20cc2f2ea85625157e7c107cfe5e418c2ccbcbda/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.4.4.png)

### 4.7 邮件访问协议

![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/20cc2f2ea85625157e7c107cfe5e418c2ccbcbda/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.4.5.png)

1. SMTP:传送到接收方的邮件服务器
2. 邮件访问协议：从服务器访问邮件
   + POP:邮局访问协议（Post Office Protocol)[RFC 1939]
     + 用户身份确认（代理<-->服务器）并下载
   + IMAP:Internet邮件访问协议（Internet Mail Access Protocol)[RFC 1730]
     + 更多特性（更复杂）
     + 在服务器上处理存储的报文
   + HTTP：Hotmail,yahool!Mail等

## 5、 DNS

### 5.1 DNS(Domain Name System)

1. DNS的必要性
   + IP地址标示主机、路由器
   + 但IP地址不好记忆，不便人类使用（没有意义）
   + 人类一般倾向于使用一些有意义的字符来标示Internet上的设备
   + 存在着"字符串"——IP地址的转换的必要性
   + 人类用户提供要访问机器的“字符串”名称
   + 由DNS负责转换成为二进制的网络地址
2. DNS的历史
   1. ARPANET的名字解析解决方案
      + 主机名：没有层次的一个字符串（一个平面）
      + 存在着一个（集中）的维护站：维护着一张主机名-IP地址的映射文件：Hosts.txt
      + 每台主机定时从维护站取文件
   2. ARPANET解决方案的问题
      + 当网络中主机数量很大时
        + 没有层次的主机名称很难分配
        + 文件的管理、发布、查找都很麻烦
3. DNS的总体思路和目标：
   1. DNS的主要思路
      + ==分层==的、基于域的命名机制
      + 若干==分布式==的数据库完成名字到IP地址的转换
      + 运行在UDP之上端口号为53的应用服务
      + 核心的Internet功能，但以应用层协议实现
        + 在网络边缘处理复杂性
   2. DNS主要目的：
      + 实现主机名-IP地址的转换
      + 其他目的
        + ==主机别名==到==规范名字==的转换：Host aliasing
        + 邮件服务器==别名==到邮件服务器的==正规名字==的转换：Mail server aliasing
        + ==负载均衡：==Load Distribution
4. DNS系统需要解决的问题
   1. 问题1：如何命名设备
      + 用有意义的字符串：好记，便于人类使用
      + 解决一个平面命名的重名问题：层次化命名
   2. 问题2：如何完成名字到IP地址的转换
      + 分布式的数据库维护和响应名字查询
   3. 问题3：如何维护：增加或者删除一个域，需要在域名系统中做哪些工作

### 5.2 问题1：DNS名字空间（The DNS Name Space)

1. DNS域名结构

   + 一个层次命名设备会有很多重名
   + DNS采用层次树状结构的命名方法
   + Internet根被划为几百个顶级域（top lever domains)
     + 通用的（generic)
       + .com;.edu;.gov;.int;.web
     + 国家的(countries)
       + .cn;.us;.nl;.jp
   + 每个（子）域下面可划分为若干子域
   + 树叶是主机

2. DNS名字空间

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.1.png)

  1. 域名（Domain Name)

   + 从本域往上，直到树根
   + 中间使用“.”间隔不同的级别
   + 例如：xatu.edu.cn
   + 域的域名：可以用来表示一个域
   + 主机的域名：一个域上的主机

  2. 域名的管理

   + 一个域管理其下的子域
     + .jp被划分为ac.jp  co.jp
     + .cn被划分为edu.cn com.cn
   + 创建一个新的域，必须征得它所属域的同意

    3. 域与物理网络无关
       + 域遵从组织界限，而不是物理网络
         + 一个域的主机可以不在一个网络
         + 一个网络的主机不一定在一个域
       + 域的划分是逻辑的，而不是物理的

### 5.3 问题2：解析问题-名字服务器（Name Server)

1. 一个名字服务器的问题

   + 可靠性问题：单点故障
   + 扩展性问题：通信容量
   + 维护问题：远距离的集中式数据库

2. 区域（zone)

   + 区域的划分由区域管理者自己决定
   + 将DNS名字空间划分为互不相交的区域，每个区域都是树的一部分
   + 名字服务器：
     + 每个区域都有一个名字服务器：维护着它所管辖区域的权威信息
     + 名字服务器允许被放置在区域之外，以保障可靠性

3. 名字空间划分为若干区域:Zone

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.2.png)

   权威DNS服务器：组织机构的DNS服务器，提供组织机构服务器(如Web和mail)可访问的主机和IP之间的映射

   组织机构可以选择实现自己维护或由某个服务提供商来维护

4. ==顶级域(TLD)服务器：==负责顶级域名（如com,org,net,edu和gov)和所有国家级的顶级域名（如cn,uk,ffr,ca,jp)

   + Network solutions公司维护com TLD服务器
   + Educause公司维护edu TLD服务器

5. 区域名字服务器维护资源记录

   + 资源记录：	
     + 作用：维护域名-IP地址(其他)的映射关系
     + 位置：Name Server的分布式数据库中
   + RR格式：
     + Domain_name:域名
     + Ttl:time to live:生存时间（权威，缓冲记录）
     + Class类别：对于Internet，值为IN
     + Value值：可以是数字，域名或ASCII串
     + Type类别：
       + Type=A:Name为主机，Value为IP地址
       + Type=CNAME:Name为规范名字的别名，Value为规范名字
       + Type=NS:Name为域名(如foo.com),Value为该域名的权威服务器的域名
       + Type=MX:Value为name对应的邮件服务器的名字
     + TTL:生存时间，决定了资源记录应当从缓存中删除的时间

6. DNS大致工作过程

   + 应用调用解析器(resolver)
   + 解析器作为客户向Name Server发出查询报文（封装在UDP段中）
   + Name Server返回响应报文（name/ip)

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.3.png)

7. 本地名字服务器（Local Name Server)

   + 并不严格属于层次结构
   + 每个ISP（居民区的ISP、公司、大学）都有一个本地DNS服务器
     + 也称为“默认名字服务器”
   + 当一个主机发起一个DNS查询时，查询被送到其本地DNS服务器
     + 起着代理的作用，将查询转发到层次结构中

8. 名字服务器（Name Server)

   1. 名字解析过程

      + 目标名字在Local Name Server中
        + 情况1：查询的名字在该区域内部
        + 情况2：缓存（cashing)

   2. 当本地名字服务器不能解析名字时，联系根名字服务器顺着根-TLD一直找到权威名字服务器

   3. 递归查询

      ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.4.png)

      + 名字解析负担都放在当前联络的名字服务器上
      + 问题：根服务器的负担太重
      + 解决：迭代查询

   4. 迭代查询

      ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.5.png)

      + 主机cis.poly.edu想知道主机gaia.cs.umass.edu的IP地址
      + 根（及各级域名）服务器返回的不是查询结果，而是下一个NS的地址
      + 最后由权威名字服务器给出解析结果
      + 当前联络的服务器给出可以联系的服务器的名字
      + “我不知道这个名字，但是我可以向这个服务器请求”

9. DNS协议、报文

   DNS协议：==查询==和==响应==报文的==报文格式==相同

   ![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.6.png)![](https://gitee.com/xatu-han-chen/computer-network-learning/raw/36807173267e56e64e9e2ca1dd0b8c70de40368e/%E4%B8%AD%E7%A7%91%E5%A4%A7%20%E9%83%91%E7%83%87/resource/2.5.7.png)

10. 提高性能：缓存

    + 一旦名字服务器学到了一个映射，就将该映射缓存起来
    + 根服务器通常都在本地服务器中缓存着
      + 使得根服务器不用经常被访问
    + 目的：提高效率
    + 可能存在的问题：如果情况变化，缓存结果和权威资源记录不一致
    + 解决方案：TTL(默认2天)



### 5.4 问题3：维护问题：新增一个域

1. 在上级域的名字服务器中增加两条记录，指向这个新增的子域的域名和域名服务器的地址
2. 在新增子域的名字服务器上运行名字服务器，负责本域的名字解析：名字-->IP地址
3. 例子：在com域中建立一个“Network Utopia”
4. 到注册登记机构注册域名networkutopia.com
   + 需要向该机构提供权威DNS服务器（基本的、和辅助的）的名字和IP地址
   + 登记机构在com TLD服务器中插入两条RR记录: (networkutopia.com, dns1.networkutopia.com, NS) (dns1.networkutopia.com, 212.212.212.1, A)
5. 在networkutopia.com的权威服务器中确保有
   + 用于Web服务器的www.networkuptopia.com的类型为A的记录
   + 用于邮件服务器mail.networkutopia.com的类型为MX的记录
